var Task=function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=1)}([function(t,e){t.exports=function(t){var e,r=t.toString();r=r.substring(r.indexOf("{")+1,r.lastIndexOf("}"));try{e=new Blob([r],{type:"text/javascript"})}catch(t){window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder,(e=new BlobBuilder).append(r),e=e.getBlob()}return(window.URL||window.webkitURL).createObjectURL(e)}},function(t,e,r){function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){return!e||"object"!==n(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function i(t){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function s(t,e){return(s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var a,u=r(2),l=r(3);r(4);u()&&(a={DefaultWorkerProxy:r(5)}),t.exports=function(t){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),!a)throw new Error("The browser does not support Workers");var r={workerType:"web_worker"};return Object.keys(t).forEach(function(e){return r[e]=t[e]}),o(this,i(e).call(this,r,a))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&s(t,e)}(e,l),e}()},function(t,e,r){var n=r(0);t.exports=function(){if("undefined"!=typeof Worker&&(window.URL||window.webkitURL))try{return new Worker(n(function(){})).terminate(),!0}catch(t){}return!1}},function(t,e,r){function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function a(t,e,r){return e&&s(t.prototype,e),r&&s(t,r),t}var u=function(){function t(e){i(this,t),this.transferables=e.map(function(t){if(!(t instanceof ArrayBuffer)&&t&&t.buffer instanceof ArrayBuffer)return t.buffer;if(t instanceof ArrayBuffer)return t;throw new Error("Task.js: invalid transferable argument (ensure its a buffer backed array, or a buffer)")})}return a(t,[{key:"toArray",value:function(){return this.transferables}}]),t}(),l=function(){function t(e,n){var s=this;if(i(this,t),o(this,"_next",function(){if(s._taskTimeout&&s._reissueTasksInTimedoutWorkers(),s._queue.length){var t=s._getWorker();if(t){var e=s._queue.shift();s._debug&&s._log({action:"send_task_to_worker",taskId:e.id,workerId:t.id,message:"sending taskId(".concat(e.id,") to workerId(").concat(t.id,")")}),t.run(e)}else setTimeout(s._next,0)}}),o(this,"_onWorkerTaskComplete",function(){s._next()}),o(this,"_onWorkerExit",function(t){s._debug&&s._log({action:"worker_died",workerId:t.id,message:"worker died, reissuing tasks"}),s._workers=s._workers.filter(function(e){return e!=t}),t.tasks.forEach(function(t){s._queue.push(t.$options)}),s._next()}),e=e||{},this.id=++t.managerCount,"worker_threads"===e.workerType){try{r(!function(){var t=new Error("Cannot find module 'worker_threads'");throw t.code="MODULE_NOT_FOUND",t}())}catch(t){throw new Error("Your current version, or configuration of Node.js does not support worker_threads.")}this._WorkerProxy=n.NodeWorkerThread}else this._WorkerProxy=n.DefaultWorkerProxy;if(this._logger=e.logger||console.log,this._requires=e.requires,"worker_threads"!==e.workerType&&"fork_worker"!==e.workerType&&this._requires)throw new Error("Task.js requires is not supported in a clientside environment.");if(this._workerTaskConcurrency=(e.workerTaskConcurrency||1)-1,this._maxWorkers=e.maxWorkers||1,this._idleTimeout=!1!==e.idleTimeout&&e.idleTimeout,this._taskTimeout=e.taskTimeout||0,this._idleCheckInterval=1e3,this._warmStart=e.warmStart||!1,this._globals=e.globals,this._globalsInitializationFunction=e.initialize,this._debug=e.debug,this._debug&&this._log({action:"create_new_pool",message:"creating new pool : ".concat(JSON.stringify(e)),config:e}),this._workers=[],this._workersInitializing=[],this._queue=[],this._onWorkerTaskComplete=this._onWorkerTaskComplete.bind(this),this._flushIdleWorkers=this._flushIdleWorkers.bind(this),this._totalWorkersCreated=0,this._lastTaskTimeoutCheck=new Date,this._warmStart){this._debug&&this._log({action:"warmstart",message:"warm starting workers"});for(var a=0;a<this._maxWorkers;a++)this._createWorker()}}return a(t,[{key:"_log",value:function(t){var e={source:"manager",managerId:this.id};Object.keys(t).forEach(function(r){e[r]=t[r]}),e.message||(e.message=e.action),this._logger(e,this)}},{key:"getActiveWorkerCount",value:function(){return this._workersInitializing.length+this._workers.length}},{key:"_run",value:function(e){if(this._idleTimeout&&"number"!=typeof this._idleCheckIntervalID&&(this._idleCheckIntervalID=setInterval(this._flushIdleWorkers,this._idleCheckInterval)),!e.arguments||void 0===e.arguments.length)throw new Error('task.js: "arguments" is required property, and it must be an array/array-like');if(!e.function&&("function"!=typeof e.function||"string"!=typeof e.function))throw new Error('task.js: "function" is required property, and it must be a string or a function');return"object"===n(e.arguments)&&(e.arguments=Array.prototype.slice.call(e.arguments)),e.id=++t.taskCount,this._debug&&this._log({action:"add_to_queue",taskId:e.id,message:"added taskId(".concat(e.id,") to the queue")}),new Promise(function(t,r){e.resolve=t,e.reject=r,this._queue.push(e),this._next()}.bind(this))}},{key:"_runOnWorker",value:function(e,r,n){return new Promise(function(o,i){e.run({id:++t.taskCount,arguments:r,function:n,resolve:o,reject:i})})}},{key:"run",value:function(t){for(var e=this.wrap(t),r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];return e.apply(void 0,n)}},{key:"wrap",value:function(t){return function(){var e=Array.from(arguments),r=null,n=e.slice(-1)[0];return n instanceof u&&(r=n.toArray(),e=e.slice(0,-1)),this._run({arguments:e,transferables:r,function:t})}.bind(this)}},{key:"terminate",value:function(){this._debug&&this._log({action:"terminated",message:"terminated"}),this._idleTimeout&&"number"==typeof this._idleCheckIntervalID&&(clearInterval(this._idleCheckIntervalID),this._idleCheckIntervalID=null),this._workers.forEach(function(t){t.terminate()}),this._workers=[]}},{key:"_reissueTasksInTimedoutWorkers",value:function(){var t=this;new Date-this._lastTaskTimeoutCheck<5e3||(this._lastTaskTimeoutCheck=new Date,this._workers.forEach(function(e){e.tasks.some(function(r){if(new Date-r.startTime>=t._taskTimeout)return e.forceExit(),!0})}))}},{key:"_flushIdleWorkers",value:function(){this._debug&&this._log({action:"flush_idle_workers",message:"flushing idle workers"}),this._workers=this._workers.filter(function(t){return!(0===t.tasks.length&&new Date-t.lastTaskTimestamp>this._idleTimeout)||(t.terminate(),!1)},this)}},{key:"_getWorker",value:function(){var t=this,e=this._workers.filter(function(e){return e.tasks.length<=t._workerTaskConcurrency}).sort(function(t,e){return t.tasks.length-e.tasks.length});return e.length?e[0]:this._workers.length<this._maxWorkers&&0===this._workersInitializing.length?this._createWorker():null}},{key:"_createWorker",value:function(){var t=++this._totalWorkersCreated,e=new this._WorkerProxy({debug:this._debug,logger:this._logger,id:t,managerId:this.id,onTaskComplete:this._onWorkerTaskComplete,onExit:this._onWorkerExit});if(this._globalsInitializationFunction||this._globals||this._requires){this._debug&&this._log({action:"run_global_initialize",message:"running global initialization code"});var r="function (_globals) {\n\t\t\t\tlet requires = ".concat(JSON.stringify(this._requires||{}),";\n\t\t\t\tObject.keys(requires).forEach(key => {\n\t\t\t\t\tglobal[key] = require(requires[key]);\n\t\t\t\t});\n\n\t\t\t\tif (typeof _globals != 'undefined') {\n\t\t\t\t\tObject.keys(_globals).forEach(key => {\n\t\t\t\t\t\tglobal[key] = _globals[key];\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t(").concat((this._globalsInitializationFunction||function(){}).toString(),")();\n\t\t\t}").trim();return this._workersInitializing.push(e),this._runOnWorker(e,[this._globals||{}],r).then(function(){this._workersInitializing=this._workersInitializing.filter(function(t){return t!=e}),this._workers.push(e)}.bind(this)),null}return this._workers.push(e),e}}],[{key:"transferables",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return new u(e)}}]),t}();o(l,"managerCount",0),o(l,"taskCount",0),t.exports=l},function(t,e){t.exports=function(t,e,r){return function(n,o){var i={};return Object.keys(t).forEach(function(e){return i[e]=t[e]}),Object.keys(n).forEach(function(t){return i[t]=n[t]}),new r(i,o||e)}}},function(t,e,r){function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function i(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function s(t,e){return(s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function a(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var u=r(0),l=r(6),c=function(t){function e(t){var r,s,l;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),s=this,l=o(e).apply(this,arguments),r=!l||"object"!==n(l)&&"function"!=typeof l?i(s):l,a(i(r),"WORKER_SOURCE","function () {\n\t\tlet global = new Proxy(\n\t\t  {},\n\t\t  {\n\t\t    set: (obj, prop, newval) => (self[prop] = newval)\n\t\t  }\n\t\t);\n\n\t\tonmessage = function (event) {\n\t\t\tvar message = event.data;\n\n\t\t\tvar args = Object.keys(message).filter(function (key) {\n\t\t\t\treturn key.match(/^argument/);\n\t\t\t}).sort(function (a, b) {\n\t\t\t\treturn parseInt(a.slice(8), 10) - parseInt(b.slice(8), 10);\n\t\t\t}).map(function (key) {\n\t\t\t\treturn message[key];\n\t\t\t});\n\n\t\t\ttry {\n\t\t\t\tvar result = eval('(' + message.func + ')').apply(null, args);\n\n\t\t\t\tif (typeof Promise != 'undefined' && result instanceof Promise) {\n\t\t\t\t\tresult.then(function (result) {\n\t\t\t\t\t\tpostMessage({id: message.id, result: result});\n\t\t\t\t\t}).catch(function (error) {\n\t\t\t\t\t\tpostMessage({id: message.id, error: error.stack});\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tpostMessage({id: message.id, result: result});\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tpostMessage({id: message.id, error: error.stack});\n\t\t\t}\n\t\t}\n\t}"),a(i(r),"_onMessage",function(t){var e=t.data;r.handleWorkerMessage(e)}),a(i(r),"postMessage",function(t,e){r._debug&&r._log({taskId:t.id,action:"send_task_to_actual_worker",message:"sending taskId(".concat(t.id,") to worker process")}),r._worker.postMessage(t,e)}),a(i(r),"terminate",function(){r._debug&&r._log({message:"terminated"}),r._worker.terminate()}),r._worker=new Worker(u(r.WORKER_SOURCE)),r._worker.addEventListener("message",r._onMessage),r._debug&&r._log({action:"initialized"}),r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&s(t,e)}(e,l),e}();t.exports=c},function(t,e){function r(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function n(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var o=function(){function t(e){var r=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),n(this,"handleWorkerExit",function(){r._debug&&r._log({action:"killed"}),r._onExitHandler(r)}),n(this,"forceExit",function(){r._onExit(),r._worker.kill()}),n(this,"handleWorkerMessage",function(t){var e=null;if(r.tasks.some(function(r,n){if(t.id===r.id)return e=n,!0}),null!==e){var n=r.tasks[e];t.error?(r._debug&&r._log({taskId:n.id,action:"task_error",message:"taskId(".concat(n.id,") has thrown an error ").concat(t.error)}),n.reject(new Error("task.js: ".concat(t.error)))):(r._debug&&r._log({taskId:n.id,action:"task_completed",message:"taskId(".concat(n.id,") has completed")}),n.resolve(t.result)),r._onTaskComplete(r),r.tasks.splice(e,1)}}),this.id=e.id,this.managerId=e.managerId,this._debug=e.debug,this._logger=e.logger,this.tasks=[],this.lastTaskTimestamp=null,this._onTaskComplete=e.onTaskComplete,this._onExitHandler=e.onExit}var e,o,i;return e=t,(o=[{key:"_log",value:function(t){var e={source:"worker",managerId:this.managerId,workerId:this.id};Object.keys(t).forEach(function(r){e[r]=t[r]}),e.message||(e.message=e.action),this._logger(e)}},{key:"run",value:function(t){this.lastTaskTimestamp=new Date;var e={id:t.id,startTime:new Date,resolve:t.resolve,reject:t.reject,$options:t};this.tasks.push(e);var r={id:e.id,func:String(t.function)};Object.keys(t.arguments).forEach(function(e,n){r["argument"+n]=t.arguments[n]}),this.postMessage(r,t.transferables)}},{key:"_purgeTasks",value:function(t){this.tasks.forEach(function(e){e.reject(t)}),this.tasks=[]}}])&&r(e.prototype,o),i&&r(e,i),t}();t.exports=o}]);
//# sourceMappingURL=task.js.map