var Task=function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=2)}([function(t,e){t.exports=function(t){var e,r=t.toString();r=r.substring(r.indexOf("{")+1,r.lastIndexOf("}"));try{e=new Blob([r],{type:"text/javascript"})}catch(t){window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder,(e=new BlobBuilder).append(r),e=e.getBlob()}return(window.URL||window.webkitURL).createObjectURL(e)}},function(t,e){function r(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function n(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var o=function(){function t(e){var r=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),n(this,"handleWorkerExit",function(){r._log("killed"),r._onExitHandler(r)}),n(this,"forceExit",function(){r._onExit(),r._worker.kill()}),n(this,"handleWorkerMessage",function(t){var e=null;if(r.tasks.some(function(r,n){if(t.id===r.id)return e=n,!0}),null!==e){var n=r.tasks[e];t.error?(r._log("taskId(".concat(n.id,") has thrown an error ").concat(t.error)),n.reject(new Error("task.js: ".concat(t.error)))):(r._log("taskId(".concat(n.id,") has completed")),n.resolve(t.result)),r._onTaskComplete(r),r.tasks.splice(e,1)}}),this.id=e.id,this.managerId=e.managerId,this._debug=e.debug,this._logger=e.logger,this.tasks=[],this.lastTaskTimestamp=null,this._onTaskComplete=e.onTaskComplete,this._onExitHandler=e.onExit}var e,o,i;return e=t,(o=[{key:"_log",value:function(t){this._debug&&this._logger("task.js:worker[managerId(".concat(this.managerId,") workerId(").concat(this.id,")]: ").concat(t))}},{key:"run",value:function(t){this.lastTaskTimestamp=new Date;var e={id:t.id,startTime:new Date,resolve:t.resolve,reject:t.reject,$options:t};this.tasks.push(e);var r={id:e.id,func:String(t.function)};Object.keys(t.arguments).forEach(function(e,n){r["argument"+n]=t.arguments[n]}),this.postMessage(r,t.transferables)}},{key:"_purgeTasks",value:function(t){this.tasks.forEach(function(e){e.reject(t)}),this.tasks=[]}}])&&r(e.prototype,o),i&&r(e,i),t}();t.exports=o},function(t,e,r){function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){return!e||"object"!==n(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function i(t){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function s(t,e){return(s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var u=r(3),a=r(4),c=(r(6),{CompatibilityWorker:r(7)});u()&&(c.DefaultWorkerProxy=r(8)),t.exports=function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),o(this,i(e).call(this,t,c))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&s(t,e)}(e,a),e}()},function(t,e,r){var n=r(0);t.exports=function(){if("undefined"!=typeof Worker&&(window.URL||window.webkitURL))try{return new Worker(n(function(){})).terminate(),!0}catch(t){}return!1}},function(t,e,r){(function(e){function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function i(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var s=function(){function t(n,o){var s=this;if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),i(this,"_next",function(){if(s._taskTimeout&&s._reissueTasksInTimedoutWorkers(),s._queue.length){var t=s._getWorker();if(t){var e=s._queue.shift();s._log("sending taskId(".concat(e.id,") to workerId(").concat(t.id,")")),t.run(e)}else setTimeout(s._next,0)}}),i(this,"_onWorkerTaskComplete",function(){s._next()}),i(this,"_onWorkerExit",function(t){s._log("worker died, reissuing task"),s._workers=s._workers.filter(function(e){return e!=t}),t.tasks.forEach(function(t){s._queue.push(t.$options)}),s._next()}),n=n||{},this.id=++t.managerCount,"worker_threads"===n.workerType){try{r(!function(){var t=new Error("Cannot find module 'worker_threads'");throw t.code="MODULE_NOT_FOUND",t}())}catch(t){console.error("Your current version, or configuration of Node.js does not support worker_threads."),e.exit(1)}this._WorkerProxy=o.NodeWorkerThread}else"compatibility_worker"==n.workerType?this._WorkerProxy=o.CompatibilityWorker:this._WorkerProxy=o.DefaultWorkerProxy;if(this._logger=n.logger||console.log,this._workerTaskConcurrency=(n.workerTaskConcurrency||1)-1,this._maxWorkers=n.maxWorkers||4,this._idleTimeout=!1!==n.idleTimeout&&n.idleTimeout,this._taskTimeout=n.taskTimeout||0,this._idleCheckInterval=n.idleCheckInterval||1e3,this._warmStart=n.warmStart||!1,this._globals=n.globals,this._globalsInitializationFunction=n.initialize,this._debug=n.debug,this._log("creating new pool : ".concat(JSON.stringify(n))),this._workers=[],this._workersInitializing=[],this._queue=[],this._onWorkerTaskComplete=this._onWorkerTaskComplete.bind(this),this._flushIdleWorkers=this._flushIdleWorkers.bind(this),this._totalWorkersCreated=0,this._lastTaskTimeoutCheck=new Date,this._warmStart){this._log("warm starting workers");for(var u=0;u<this._maxWorkers;u++)this._createWorker()}}var s,u,a;return s=t,(u=[{key:"_log",value:function(t){this._debug&&this._logger("task.js:manager[managerId(".concat(this.id,")] ").concat(t))}},{key:"getActiveWorkerCount",value:function(){return this._workersInitializing.length+this._workers.length}},{key:"run",value:function(e){if(this._idleTimeout&&"number"!=typeof this._idleCheckIntervalID&&(this._idleCheckIntervalID=setInterval(this._flushIdleWorkers,this._idleCheckInterval)),!e.arguments||void 0===e.arguments.length)throw new Error('task.js: "arguments" is required property, and it must be an array/array-like');if(!e.function&&("function"!=typeof e.function||"string"!=typeof e.function))throw new Error('task.js: "function" is required property, and it must be a string or a function');return"object"===n(e.arguments)&&(e.arguments=Array.prototype.slice.call(e.arguments)),e.id=++t.taskCount,this._log("added taskId(".concat(e.id,") to the queue")),new Promise(function(t,r){e.resolve=t,e.reject=r,this._queue.push(e),this._next()}.bind(this))}},{key:"_runOnWorker",value:function(e,r,n){return new Promise(function(o,i){e.run({id:++t.taskCount,arguments:r,function:n,resolve:o,reject:i})})}},{key:"wrap",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{useTransferables:!1},r=e.useTransferables;return function(){var e=Array.from(arguments),n=null;if(r){if(n=e.slice(-1)[0],!Array.isArray(n))throw new Error("Task expects to be passed a transferables array as its last argument.");e=e.slice(0,-1)}return this.run({arguments:e,transferables:n,function:t})}.bind(this)}},{key:"terminate",value:function(){this._log("terminated"),this._idleTimeout&&"number"==typeof this._idleCheckIntervalID&&(clearInterval(this._idleCheckIntervalID),this._idleCheckIntervalID=null),this._workers.forEach(function(t){t.terminate()}),this._workers=[]}},{key:"_reissueTasksInTimedoutWorkers",value:function(){var t=this;new Date-this._lastTaskTimeoutCheck<5e3||(this._lastTaskTimeoutCheck=new Date,this._workers.forEach(function(e){e.tasks.some(function(r){if(new Date-r.startTime>=t._taskTimeout)return e.forceExit(),!0})}))}},{key:"_flushIdleWorkers",value:function(){this._log("flushing idle workers"),this._workers=this._workers.filter(function(t){return!(0===t.tasks.length&&new Date-t.lastTaskTimestamp>this._idleTimeout&&(t.terminate(),1))},this)}},{key:"_getWorker",value:function(){var t=this,e=this._workers.filter(function(e){return e.tasks.length<=t._workerTaskConcurrency}).sort(function(t,e){return t.tasks.length-e.tasks.length});return e.length?e[0]:this._workers.length<this._maxWorkers&&0===this._workersInitializing.length?this._createWorker():null}},{key:"_createWorker",value:function(){var t=++this._totalWorkersCreated,e=new this._WorkerProxy({debug:this._debug,logger:this._logger,id:t,managerId:this.id,onTaskComplete:this._onWorkerTaskComplete,onExit:this._onWorkerExit});if(this._globalsInitializationFunction||this._globals){this._log("running global initialization code");var r="\n\t\t\t\tfunction (_globals) {\n\t\t\t\t\tglobals = (".concat((this._globalsInitializationFunction||function(t){return t}).toString(),")(_globals || {});\n\t\t\t\t}\n\t\t\t").trim();return this._workersInitializing.push(e),this._runOnWorker(e,[this._globals||{}],r).then(function(){this._workersInitializing=this._workersInitializing.filter(function(t){return t!=e}),this._workers.push(e)}.bind(this)),null}return this._workers.push(e),e}}])&&o(s.prototype,u),a&&o(s,a),t}();i(s,"managerCount",0),i(s,"taskCount",0),t.exports=s}).call(this,r(5))},function(t,e){var r,n,o=t.exports={};function i(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function u(t){if(r===setTimeout)return setTimeout(t,0);if((r===i||!r)&&setTimeout)return r=setTimeout,setTimeout(t,0);try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:i}catch(t){r=i}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(t){n=s}}();var a,c=[],l=!1,f=-1;function h(){l&&a&&(l=!1,a.length?c=a.concat(c):f=-1,c.length&&p())}function p(){if(!l){var t=u(h);l=!0;for(var e=c.length;e;){for(a=c,c=[];++f<e;)a&&a[f].run();f=-1,e=c.length}a=null,l=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function d(t,e){this.fun=t,this.array=e}function y(){}o.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];c.push(new d(t,e)),1!==c.length||l||u(p)},d.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=y,o.addListener=y,o.once=y,o.off=y,o.removeListener=y,o.removeAllListeners=y,o.emit=y,o.prependListener=y,o.prependOnceListener=y,o.listeners=function(t){return[]},o.binding=function(t){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(t){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},function(t,e){t.exports=function(t,e,r){return function(n,o){var i={};return Object.keys(t).forEach(function(e){return i[e]=t[e]}),Object.keys(n).forEach(function(t){return i[t]=n[t]}),new r(i,o||e)}}},function(t,e,r){function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e,r){return(o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,r){var n=[null];n.push.apply(n,e);var o=new(Function.bind.apply(t,n));return r&&a(o,r.prototype),o}).apply(null,arguments)}function i(t){return function(t){if(Array.isArray(t)){for(var e=0,r=new Array(t.length);e<t.length;e++)r[e]=t[e];return r}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function u(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function a(t,e){return(a=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function c(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var l=r(1),f=function(t){function e(){var t,r,a;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),r=this,a=s(e).apply(this,arguments),t=!a||"object"!==n(a)&&"function"!=typeof a?u(r):a,c(u(t),"postMessage",function(e,r){t._setTimeoutID=setTimeout(function(){var r=Object.keys(e).filter(function(t){return t.match(/^argument/)}).sort(function(t,e){return parseInt(t.slice(8),10)-parseInt(e.slice(8),10)}).map(function(t){return e[t]}),n=e.func.substring(e.func.indexOf("{")+1,e.func.lastIndexOf("}")),s=e.func.substring(e.func.indexOf("(")+1,e.func.indexOf(")")).split(","),u=o(Function,i(s).concat([n]));try{var a=u.apply(void 0,i(r));t.handleWorkerMessage({id:e.id,result:a})}catch(r){t.handleWorkerMessage({id:e.id,error:r.stack})}},1)}),c(u(t),"terminate",function(){clearTimeout(t._setTimeoutID),t._setTimeoutID=null}),t._setTimeoutID=null,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&a(t,e)}(e,l),e}();t.exports=f},function(t,e,r){function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function i(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function s(t,e){return(s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function u(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var a=r(0),c=r(1),l=function(t){function e(t){var r,s,c;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),s=this,c=o(e).apply(this,arguments),r=!c||"object"!==n(c)&&"function"!=typeof c?i(s):c,u(i(r),"WORKER_SOURCE","function () {\n\t\tonmessage = function (event) {\n\t\t\tvar message = event.data;\n\n\t\t\tvar args = Object.keys(message).filter(function (key) {\n\t\t\t\treturn key.match(/^argument/);\n\t\t\t}).sort(function (a, b) {\n\t\t\t\treturn parseInt(a.slice(8), 10) - parseInt(b.slice(8), 10);\n\t\t\t}).map(function (key) {\n\t\t\t\treturn message[key];\n\t\t\t});\n\n\t\t\ttry {\n\t\t\t\tvar result = eval('(' + message.func + ')').apply(null, args);\n\n\t\t\t\tif (typeof Promise != 'undefined' && result instanceof Promise) {\n\t\t\t\t\tresult.then(function (result) {\n\t\t\t\t\t\tpostMessage({id: message.id, result: result});\n\t\t\t\t\t}).catch(function (error) {\n\t\t\t\t\t\tpostMessage({id: message.id, error: error.stack});\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tpostMessage({id: message.id, result: result});\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tpostMessage({id: message.id, error: error.stack});\n\t\t\t}\n\t\t}\n\t}"),u(i(r),"_onMessage",function(t){var e=t.data;r.handleWorkerMessage(e)}),u(i(r),"postMessage",function(t,e){r._log("sending taskId(".concat(t.id,") to worker process")),r._worker.postMessage(t,e)}),u(i(r),"terminate",function(){r._log("terminated"),r._worker.terminate()}),r._worker=new Worker(a(r.WORKER_SOURCE)),r._worker.addEventListener("message",r._onMessage),r._log("initialized"),r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&s(t,e)}(e,c),e}();t.exports=l}]);
//# sourceMappingURL=task.js.map