/*! task.js - 0.0.30 - clientside/minified */
var task=function(t){function e(n){if(r[n])return r[n].exports;var o=r[n]={exports:{},id:n,loaded:!1};return t[n].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var r={};return e.m=t,e.c=r,e.p="",e(0)}([function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}var o=r(1),i=n(o),s=r(3),a=n(s),u=r(5),l=n(u),c={maxWorkers:navigator.hardwareConcurrency},f=r((0,i.default)()?6:8);t.exports=new a.default(c,{DefaultWorkerProxy:f}),t.exports.defaults=(0,l.default)(c,{DefaultWorkerProxy:f},a.default)},function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}var o=r(2),i=n(o);t.exports=function(){if("undefined"!=typeof Worker&&(window.URL||window.webkitURL))try{var t=new Worker((0,i.default)(function(){}));return t.terminate(),!0}catch(t){}return!1}},function(t,e){"use strict";t.exports=function(t){var e,r=t.toString();r=r.substring(r.indexOf("{")+1,r.lastIndexOf("}"));try{e=new Blob([r],{type:"text/javascript"})}catch(t){window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder,e=new BlobBuilder,e.append(r),e=e.getBlob()}return(window.URL||window.webkitURL).createObjectURL(e)}},function(t,e,r){(function(e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=function(){function t(o,i){var s=this;if(n(this,t),this.decorate=function(t,e){return t[e]=s.wrap(t[e]),t},this._next=function(){if(s._taskTimeout&&s._reissueTasksInTimedoutWorkers(),s._queue.length){var t=s._getWorker();if(!t)return void setTimeout(s._next,0);var e=s._queue.shift();s._log("sending taskId("+e.id+") to workerId("+t.id+")"),t.run(e)}},this._onWorkerTaskComplete=function(){s._next()},this._onWorkerExit=function(t){s._log("worker died, reissuing task"),s._workers=s._workers.filter(function(e){return e!=t}),t.tasks.forEach(function(t){s._queue.push(t.$options)}),s._next()},o=o||{},this.id=++t.managerCount,"worker_threads"===o.workerType){try{r(!function(){var t=new Error('Cannot find module "worker_threads"');throw t.code="MODULE_NOT_FOUND",t}())}catch(t){console.error("Your current version, or configuration of Node.js does not support worker_threads."),e.exit(1)}this._WorkerProxy=i.NodeWorkerThread}else this._WorkerProxy=i.DefaultWorkerProxy;if(this._logger=o.logger||console.log,this._workerTaskConcurrency=(o.workerTaskConcurrency||1)-1,this._maxWorkers=o.maxWorkers||4,this._idleTimeout=o.idleTimeout!==!1&&o.idleTimeout,this._taskTimeout=o.taskTimeout||0,this._idleCheckInterval=o.idleCheckInterval||1e3,this._warmStart=o.warmStart||!1,this._globals=o.globals,this._globalsInitializationFunction=o.initialize,this._debug=o.debug,this._log("creating new pool : "+JSON.stringify(o)),this._workers=[],this._workersInitializing=[],this._queue=[],this._onWorkerTaskComplete=this._onWorkerTaskComplete.bind(this),this._flushIdleWorkers=this._flushIdleWorkers.bind(this),this._totalWorkersCreated=0,this._lastTaskTimeoutCheck=new Date,this._warmStart){this._log("warm starting workers");for(var a=0;a<this._maxWorkers;a++)this._createWorker()}}return t.prototype._log=function(t){this._debug&&this._logger("task.js:manager[managerId("+this.id+")] "+t)},t.prototype.getActiveWorkerCount=function(){return this._workersInitializing.length+this._workers.length},t.prototype.run=function(e){if(this._idleTimeout&&"number"!=typeof this._idleCheckIntervalID&&(this._idleCheckIntervalID=setInterval(this._flushIdleWorkers,this._idleCheckInterval)),!e.arguments||"undefined"==typeof e.arguments.length)throw new Error('task.js: "arguments" is required property, and it must be an array/array-like');if(!e.function&&("function"!=typeof e.function||"string"!=typeof e.function))throw new Error('task.js: "function" is required property, and it must be a string or a function');return"object"===o(e.arguments)&&(e.arguments=Array.prototype.slice.call(e.arguments)),e.id=++t.taskCount,this._log("added taskId("+e.id+") to the queue"),e.callback?(this._queue.push(e),void this._next()):new Promise(function(t,r){e.resolve=t,e.reject=r,this._queue.push(e),this._next()}.bind(this))},t.prototype.setGlobals=function(t){this._workers.forEach(function(t){t.terminate()}),this._workers=[],this._globals=t,this._next()},t.prototype._runOnWorker=function(e,r,n){return new Promise(function(o,i){e.run({id:++t.taskCount,arguments:r,function:n,resolve:o,reject:i})})},t.prototype.wrap=function(t){return function(){var e=Array.from(arguments),r=null;return"function"==typeof e[e.length-1]&&(r=e.slice(-1).pop(),e=e.slice(0,-1)),this.run({arguments:e,function:t,callback:r})}.bind(this)},t.prototype.terminate=function(){this._log("terminated"),this._idleTimeout&&"number"==typeof this._idleCheckIntervalID&&(clearInterval(this._idleCheckIntervalID),this._idleCheckIntervalID=null),this._workers.forEach(function(t){t.terminate()}),this._workers=[]},t.prototype._reissueTasksInTimedoutWorkers=function(){var t=this;new Date-this._lastTaskTimeoutCheck<5e3||(this._lastTaskTimeoutCheck=new Date,this._workers.forEach(function(e){e.tasks.some(function(r){if(new Date-r.startTime>=t._taskTimeout)return e.forceExit(),!0})}))},t.prototype._flushIdleWorkers=function(){this._log("flushing idle workers"),this._workers=this._workers.filter(function(t){return!(0===t.tasks.length&&new Date-t.lastTaskTimestamp>this._idleTimeout)||(t.terminate(),!1)},this)},t.prototype._getWorker=function(){var t=this,e=this._workers.filter(function(e){return e.tasks.length<=t._workerTaskConcurrency}).sort(function(t,e){return t.tasks.length-e.tasks.length});return e.length?e[0]:this._workers.length<this._maxWorkers&&0===this._workersInitializing.length?this._createWorker():null},t.prototype._createWorker=function(){var t=++this._totalWorkersCreated,e=new this._WorkerProxy({debug:this._debug,logger:this._logger,id:t,managerId:this.id,onTaskComplete:this._onWorkerTaskComplete,onExit:this._onWorkerExit});if(this._globalsInitializationFunction||this._globals){this._log("running global initialization code");var r=("\n\t\t\t\tfunction (_globals) {\n\t\t\t\t\tglobals = ("+(this._globalsInitializationFunction||function(t){return t}).toString()+")(_globals || {});\n\t\t\t\t}\n\t\t\t").trim();return this._workersInitializing.push(e),this._runOnWorker(e,[this._globals||{}],r).then(function(){this._workersInitializing=this._workersInitializing.filter(function(t){return t!=e}),this._workers.push(e)}.bind(this)),null}return this._workers.push(e),e},t}();i.managerCount=0,i.taskCount=0,t.exports=i}).call(e,r(4))},function(t,e){function r(){throw new Error("setTimeout has not been defined")}function n(){throw new Error("clearTimeout has not been defined")}function o(t){if(c===setTimeout)return setTimeout(t,0);if((c===r||!c)&&setTimeout)return c=setTimeout,setTimeout(t,0);try{return c(t,0)}catch(e){try{return c.call(null,t,0)}catch(e){return c.call(this,t,0)}}}function i(t){if(f===clearTimeout)return clearTimeout(t);if((f===n||!f)&&clearTimeout)return f=clearTimeout,clearTimeout(t);try{return f(t)}catch(e){try{return f.call(null,t)}catch(e){return f.call(this,t)}}}function s(){k&&d&&(k=!1,d.length?p=d.concat(p):g=-1,p.length&&a())}function a(){if(!k){var t=o(s);k=!0;for(var e=p.length;e;){for(d=p,p=[];++g<e;)d&&d[g].run();g=-1,e=p.length}d=null,k=!1,i(t)}}function u(t,e){this.fun=t,this.array=e}function l(){}var c,f,h=t.exports={};!function(){try{c="function"==typeof setTimeout?setTimeout:r}catch(t){c=r}try{f="function"==typeof clearTimeout?clearTimeout:n}catch(t){f=n}}();var d,p=[],k=!1,g=-1;h.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];p.push(new u(t,e)),1!==p.length||k||o(a)},u.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=l,h.addListener=l,h.once=l,h.off=l,h.removeListener=l,h.removeAllListeners=l,h.emit=l,h.prependListener=l,h.prependOnceListener=l,h.listeners=function(t){return[]},h.binding=function(t){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(t){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},function(t,e){"use strict";t.exports=function(t,e,r){return function(n,o){var i={};return Object.keys(t).forEach(function(e){return i[e]=t[e]}),Object.keys(n).forEach(function(t){return i[t]=n[t]}),new r(i,o||e)}}},function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function o(t,e){for(var r=Object.getOwnPropertyNames(e),n=0;n<r.length;n++){var o=r[n],i=Object.getOwnPropertyDescriptor(e,o);i&&i.configurable&&void 0===t[o]&&Object.defineProperty(t,o,i)}return t}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):o(t,e))}var u=r(2),l=n(u),c=r(7),f=n(c),h=function(t){function e(r){i(this,e);var n=s(this,t.apply(this,arguments));return n.WORKER_SOURCE="function () {\n\t\tonmessage = function (event) {\n\t\t\tvar message = event.data;\n\n\t\t\tvar args = Object.keys(message).filter(function (key) {\n\t\t\t\treturn key.match(/^argument/);\n\t\t\t}).sort(function (a, b) {\n\t\t\t\treturn parseInt(a.slice(8), 10) - parseInt(b.slice(8), 10);\n\t\t\t}).map(function (key) {\n\t\t\t\treturn message[key];\n\t\t\t});\n\n\t\t\ttry {\n\t\t\t\tvar result = eval('(' + message.func + ')').apply(null, args);\n\n\t\t\t\tif (typeof Promise != 'undefined' && result instanceof Promise) {\n\t\t\t\t\tresult.then(function (result) {\n\t\t\t\t\t\tpostMessage({id: message.id, result: result});\n\t\t\t\t\t}).catch(function (error) {\n\t\t\t\t\t\tpostMessage({id: message.id, error: error.stack});\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tpostMessage({id: message.id, result: result});\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tpostMessage({id: message.id, error: error.stack});\n\t\t\t}\n\t\t}\n\t}",n._onMessage=function(t){var e=t.data;n.handleWorkerMessage(e)},n.postMessage=function(t,e){n._log("sending taskId("+t.id+") to worker process"),n._worker.postMessage(t,e)},n.terminate=function(){n._log("terminated"),n._worker.terminate()},n._worker=new Worker((0,l.default)(n.WORKER_SOURCE)),n._worker.addEventListener("message",n._onMessage),n._log("initialized"),n}return a(e,t),e}(f.default);t.exports=h},function(t,e){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var n=function(){function t(e){var n=this;r(this,t),this.handleWorkerExit=function(){n._log("killed"),n._onExitHandler(n)},this.forceExit=function(){n._onExit(),n._worker.kill()},this.handleWorkerMessage=function(t){var e=null;if(n.tasks.some(function(r,n){if(t.id===r.id)return e=n,!0}),null!==e){var r=n.tasks[e];t.error?(n._log("taskId("+r.id+") has thrown an error "+t.error),r.callback?r.callback(new Error("task.js: "+t.error)):r.reject(new Error("task.js: "+t.error))):(n._log("taskId("+r.id+") has completed"),r.callback?r.callback(null,t.result):r.resolve(t.result)),n._onTaskComplete(n),n.tasks.splice(e,1)}},this.id=e.id,this.managerId=e.managerId,this._debug=e.debug,this._logger=e.logger,this.tasks=[],this.lastTaskTimestamp=null,this._onTaskComplete=e.onTaskComplete,this._onExitHandler=e.onExit}return t.prototype._log=function(t){this._debug&&this._logger("task.js:worker[managerId("+this.managerId+") workerId("+this.id+")]: "+t)},t.prototype.run=function(t){this.lastTaskTimestamp=new Date;var e={id:t.id,startTime:new Date,resolve:t.resolve,reject:t.reject,callback:t.callback,$options:t};this.tasks.push(e);var r={id:e.id,func:String(t.function)};Object.keys(t.arguments).forEach(function(e,n){r["argument"+n]=t.arguments[n]}),this.postMessage(r,t.transferables)},t.prototype._purgeTasks=function(t){this.tasks.forEach(function(e){e.callback?e.callback(t):e.reject(t)}),this.tasks=[]},t}();t.exports=n},function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function o(t,e){for(var r=Object.getOwnPropertyNames(e),n=0;n<r.length;n++){var o=r[n],i=Object.getOwnPropertyDescriptor(e,o);i&&i.configurable&&void 0===t[o]&&Object.defineProperty(t,o,i)}return t}function i(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function u(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):o(t,e))}var l=r(7),c=n(l),f=function(t){function e(){s(this,e);var r=a(this,t.apply(this,arguments));return r.postMessage=function(t,e){r._setTimeoutID=setTimeout(function(){var e=Object.keys(t).filter(function(t){return t.match(/^argument/)}).sort(function(t,e){return parseInt(t.slice(8),10)-parseInt(e.slice(8),10)}).map(function(e){return t[e]}),n=t.func.substring(t.func.indexOf("{")+1,t.func.lastIndexOf("}")),o=t.func.substring(t.func.indexOf("(")+1,t.func.indexOf(")")).split(","),s=new(Function.prototype.bind.apply(Function,[null].concat(i(o),[n])));try{var a=s.apply(void 0,i(e));r.handleWorkerMessage({id:t.id,result:a})}catch(e){r.handleWorkerMessage({id:t.id,error:e.stack})}},1)},r.terminate=function(){clearTimeout(r._setTimeoutID),r._setTimeoutID=null},r._setTimeoutID=null,r}return u(e,t),e}(c.default);t.exports=f}]);
//# sourceMappingURL=task.min.js.map